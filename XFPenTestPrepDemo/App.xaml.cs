using System.Net.Http;
using Xamarin.Forms;
using XFPenTestPrepDemo.Services;

namespace XFPenTestPrepDemo
{
    public partial class App : Application
    {
        public static HttpClient HttpClient;

        public App()
        {
            InitializeComponent();

            var deviceProxyService = DependencyService.Get<IDeviceProxyService>();
            var deviceProxySettings = deviceProxyService.GetProxySettings();

            var httpClientHandler = new HttpClientHandler();

            if (deviceProxySettings != null)
                httpClientHandler.Proxy = deviceProxySettings;

            //TODO: MUST REMOVE IN PROD! VERY INSECURE
            httpClientHandler.ServerCertificateCustomValidationCallback += (sender, cert, chaun, ssPolicyError) =>
            {
                return true;
            };

            HttpClient = new HttpClient(httpClientHandler) 
            {
                
            };

            MainPage = new NavigationPage(new MainPage());
        }

        protected override void OnStart()
        {
        }

        protected override void OnSleep()
        {
        }

        protected override void OnResume()
        {
        }
    }
}
